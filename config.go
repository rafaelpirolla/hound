// /////////////////////////////////////////////////////////////////////////////

package main

// /////////////////////////////////////////////////////////////////////////////

import (
	"errors"
	"io/ioutil"

	"gopkg.in/yaml.v2"
)

// /////////////////////////////////////////////////////////////////////////////
// CONSTANTS
// /////////////////////////////////////////////////////////////////////////////

const (
	DefaultDuration = 300
)

// /////////////////////////////////////////////////////////////////////////////
// TYPES
// /////////////////////////////////////////////////////////////////////////////

type Configurer interface {
	Load(fn string) (Config, error)
}

type Config struct {
	Device      string   `yaml:"device"`
	Duration    int      `yaml:"duration"`
	CustomerIPs []string `yaml:"customer_ips"`
	Ports       []int    `yaml:"ports"`
}

// /////////////////////////////////////////////////////////////////////////////
// METHODS
// /////////////////////////////////////////////////////////////////////////////

func NewConfig() *Config {
	config := new(Config)
	config.Duration = DefaultDuration
	return config
}

// /////////////////////////////////////////////////////////////////////////////

func (c *Config) Load(fn string) error {
	if fn == "" {
		return errors.New("no file name provided")
	}

	bytes, err := ioutil.ReadFile(fn)

	if err != nil {
		return err
	}

	err = yaml.Unmarshal(bytes, c)

	if err != nil {
		return err
	}

	return nil
}

// /////////////////////////////////////////////////////////////////////////////
